<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESQL SIEM Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>

<body>
    <div class="dashboard-container">
        <!-- Header -->
        <header class="dashboard-header">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-shield-alt"></i>
                    <h1>ESQL SIEM Dashboard</h1>
                </div>
                <div class="header-actions">
                    <button id="execute-rules-btn" class="btn btn-primary">
                        <i class="fas fa-play"></i> Execute Rules
                    </button>
                    <button id="clear-alerts-btn" class="btn btn-danger">
                        <i class="fas fa-trash"></i> Clear Alerts
                    </button>
                    <button id="refresh-btn" class="btn btn-secondary">
                        <i class="fas fa-sync"></i> Refresh
                    </button>
                </div>
            </div>
        </header>

        <!-- Statistics Cards -->
        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <i class="fas fa-file-code"></i>
                </div>
                <div class="stat-content">
                    <h3 id="total-rules">0</h3>
                    <p>Total Rules</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="stat-content">
                    <h3 id="total-alerts">0</h3>
                    <p>Total Alerts</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="stat-content">
                    <h3 id="enabled-rules">0</h3>
                    <p>Enabled Rules</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                    <i class="fas fa-database"></i>
                </div>
                <div class="stat-content">
                    <h3 id="es-status">
                        <i class="fas fa-spinner fa-spin"></i>
                    </h3>
                    <p>Elasticsearch</p>
                </div>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Left Sidebar - Rules Panel -->
            <aside class="sidebar">
                <div class="sidebar-header">
                    <h2><i class="fas fa-list"></i> Detection Rules</h2>
                    <div class="rule-filters">
                        <select id="category-filter" class="filter-select">
                            <option value="">All Categories</option>
                            <option value="GDPR">GDPR</option>
                            <option value="NIST">NIST</option>
                            <option value="PCI-DSS">PCI-DSS</option>
                        </select>
                        <select id="severity-filter" class="filter-select">
                            <option value="">All Severities</option>
                            <option value="critical">Critical</option>
                            <option value="high">High</option>
                            <option value="medium">Medium</option>
                            <option value="low">Low</option>
                        </select>
                    </div>
                </div>
                <div class="rules-list" id="rules-list">
                    <div class="loading">Loading rules...</div>
                </div>
            </aside>

            <!-- Center Content - Charts and Alerts -->
            <main class="dashboard-main">
                <!-- Charts Section -->
                <section class="charts-section">
                    <h2><i class="fas fa-chart-line"></i> Analytics</h2>
                    <div class="charts-grid">
                        <div class="chart-card">
                            <h3>Alert Timeline</h3>
                            <canvas id="timeline-chart"></canvas>
                        </div>
                        <div class="chart-card">
                            <h3>Severity Distribution</h3>
                            <canvas id="severity-chart"></canvas>
                        </div>
                        <div class="chart-card">
                            <h3>Top Triggered Rules</h3>
                            <canvas id="top-rules-chart"></canvas>
                        </div>
                        <div class="chart-card">
                            <h3>Top Source IPs</h3>
                            <canvas id="top-sources-chart"></canvas>
                        </div>
                    </div>
                </section>

                <!-- Alerts Section -->
                <section class="alerts-section">
                    <div class="section-header">
                        <h2><i class="fas fa-bell"></i> Recent Alerts</h2>
                        <div class="alert-controls">
                            <select id="alert-severity-filter" class="filter-select">
                                <option value="">All Severities</option>
                                <option value="critical">Critical</option>
                                <option value="high">High</option>
                                <option value="medium">Medium</option>
                                <option value="low">Low</option>
                            </select>
                        </div>
                    </div>
                    <div class="alerts-table-container" id="alerts-container">
                        <div class="loading">No alerts yet. Click "Execute Rules" to start detection.</div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- Alert Detail Modal -->
    <div id="alert-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Alert Details</h2>
                <button class="close-btn" onclick="closeAlertModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="alert-modal-body">
                <!-- Alert details will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="spinner"></div>
        <p>Processing...</p>
    </div>

    <!-- Scripts -->
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    <script src="{{ url_for('static', filename='js/charts.js') }}"></script>
    <script src="{{ url_for('static', filename='js/alerts.js') }}"></script>
</body>

</html>